<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blaze Business OS Enterprise</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #151520;
      --bg-tertiary: #1a1a2e;
      --accent: #ff6b35;
      --accent2: #f7931e;
      --text-primary: #ffffff;
      --text-secondary: #8b8b9e;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg-primary); }
    ::-webkit-scrollbar-thumb { background: #2a2a3e; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

    /* â”€â”€â”€ Glass Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .glass {
      background: rgba(21, 21, 32, 0.7);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 16px;
      transition: all 0.3s ease;
    }
    .glass:hover {
      border-color: rgba(255, 107, 53, 0.2);
      box-shadow: 0 0 30px rgba(255, 107, 53, 0.05);
    }

    /* â”€â”€â”€ Gradient Border â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .gradient-border {
      position: relative;
    }
    .gradient-border::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 16px;
      padding: 1px;
      background: linear-gradient(135deg, rgba(255,107,53,0.3), rgba(247,147,30,0.1), transparent);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events: none;
    }

    /* â”€â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sidebar {
      width: 260px;
      background: rgba(15, 15, 24, 0.95);
      backdrop-filter: blur(20px);
      border-right: 1px solid rgba(255,255,255,0.04);
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      z-index: 50;
      transition: transform 0.3s ease;
      overflow-y: auto;
    }
    .sidebar-hidden { transform: translateX(-260px); }
    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 20px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
      border-radius: 10px;
      margin: 2px 12px;
      font-size: 14px;
      font-weight: 500;
    }
    .nav-item:hover { background: rgba(255,107,53,0.08); color: var(--text-primary); }
    .nav-item.active {
      background: linear-gradient(135deg, rgba(255,107,53,0.15), rgba(247,147,30,0.08));
      color: var(--accent);
      border-left: 3px solid var(--accent);
    }
    .nav-section {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: var(--text-secondary);
      padding: 20px 20px 8px;
      opacity: 0.5;
    }

    /* â”€â”€â”€ Main â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .main-content {
      margin-left: 260px;
      min-height: 100vh;
      transition: margin-left 0.3s ease;
    }
    .main-full { margin-left: 0; }

    /* â”€â”€â”€ Page sections â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .page { display: none; padding: 24px; }
    .page.active { display: block; }

    /* â”€â”€â”€ Stat Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stat-card {
      padding: 20px;
      position: relative;
      overflow: hidden;
    }
    .stat-card .stat-icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    .stat-card .stat-value {
      font-size: 28px;
      font-weight: 800;
      letter-spacing: -1px;
    }
    .stat-card .stat-label {
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 500;
    }
    .stat-card::after {
      content: '';
      position: absolute;
      top: -40px; right: -40px;
      width: 100px; height: 100px;
      border-radius: 50%;
      opacity: 0.06;
    }
    .stat-orange::after { background: var(--accent); }
    .stat-green::after { background: var(--success); }
    .stat-blue::after { background: var(--info); }
    .stat-gold::after { background: var(--accent2); }
    .stat-red::after { background: var(--danger); }

    /* â”€â”€â”€ Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .data-table { width: 100%; border-collapse: separate; border-spacing: 0; }
    .data-table thead th {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-secondary);
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .data-table tbody tr {
      transition: background 0.2s;
    }
    .data-table tbody tr:hover {
      background: rgba(255,107,53,0.04);
    }
    .data-table td {
      padding: 12px 16px;
      font-size: 14px;
      border-bottom: 1px solid rgba(255,255,255,0.03);
      vertical-align: middle;
    }

    /* â”€â”€â”€ Badges â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    .badge-hot { background: rgba(239,68,68,0.15); color: #f87171; }
    .badge-warm { background: rgba(245,158,11,0.15); color: #fbbf24; }
    .badge-cold { background: rgba(59,130,246,0.15); color: #60a5fa; }
    .badge-ice { background: rgba(139,139,158,0.15); color: #8b8b9e; }

    /* â”€â”€â”€ Agent Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .agent-card { padding: 20px; }
    .agent-status {
      width: 10px; height: 10px;
      border-radius: 50%;
      display: inline-block;
    }
    .status-running { background: var(--success); box-shadow: 0 0 8px rgba(34,197,94,0.5); animation: pulse-dot 2s infinite; }
    .status-idle { background: var(--text-secondary); }
    .status-error { background: var(--danger); box-shadow: 0 0 8px rgba(239,68,68,0.5); }
    @keyframes pulse-dot {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    /* â”€â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      outline: none;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: #fff;
    }
    .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); box-shadow: 0 4px 20px rgba(255,107,53,0.3); }
    .btn-ghost {
      background: rgba(255,255,255,0.05);
      color: var(--text-secondary);
      border: 1px solid rgba(255,255,255,0.08);
    }
    .btn-ghost:hover { background: rgba(255,255,255,0.1); color: var(--text-primary); }
    .btn-danger { background: rgba(239,68,68,0.15); color: #f87171; }
    .btn-danger:hover { background: rgba(239,68,68,0.25); }
    .btn-sm { padding: 6px 14px; font-size: 12px; }
    .btn-xs { padding: 4px 10px; font-size: 11px; border-radius: 6px; }

    /* â”€â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(4px);
      z-index: 100;
      display: none;
      align-items: center;
      justify-content: center;
    }
    .modal-overlay.show { display: flex; }
    .modal-content {
      background: var(--bg-secondary);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 20px;
      padding: 28px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }
    .form-group { margin-bottom: 16px; }
    .form-label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
    }
    .form-input {
      width: 100%;
      padding: 10px 14px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      font-family: 'Inter', sans-serif;
      outline: none;
      transition: border-color 0.2s;
    }
    .form-input:focus { border-color: var(--accent); }
    .form-select {
      appearance: none;
      background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%238b8b9e' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3E%3C/svg%3E");
      background-position: right 10px center;
      background-repeat: no-repeat;
      background-size: 20px;
    }

    /* â”€â”€â”€ Score Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .score-bar {
      width: 60px;
      height: 6px;
      background: rgba(255,255,255,0.06);
      border-radius: 3px;
      overflow: hidden;
    }
    .score-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.5s ease;
    }

    /* â”€â”€â”€ Tool Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tool-card {
      padding: 20px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    .tool-card:hover {
      border-color: rgba(255,107,53,0.3);
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(255,107,53,0.1);
    }
    .tool-card .tool-number {
      position: absolute;
      top: 12px; right: 16px;
      font-size: 48px;
      font-weight: 800;
      opacity: 0.04;
      line-height: 1;
    }

    /* â”€â”€â”€ Topbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .topbar {
      height: 64px;
      background: rgba(10,10,15,0.8);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255,255,255,0.04);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      position: sticky;
      top: 0;
      z-index: 40;
    }

    /* â”€â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .toast-container {
      position: fixed;
      top: 80px; right: 24px;
      z-index: 200;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .toast {
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 500;
      animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s;
      max-width: 380px;
    }
    .toast-success { background: rgba(34,197,94,0.15); color: #4ade80; border: 1px solid rgba(34,197,94,0.2); }
    .toast-error { background: rgba(239,68,68,0.15); color: #f87171; border: 1px solid rgba(239,68,68,0.2); }
    .toast-info { background: rgba(59,130,246,0.15); color: #60a5fa; border: 1px solid rgba(59,130,246,0.2); }
    @keyframes slideIn { from { transform: translateX(100px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes fadeOut { to { opacity: 0; transform: translateY(-10px); } }

    /* â”€â”€â”€ Loading Skeleton â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .skeleton {
      background: linear-gradient(90deg, rgba(255,255,255,0.04) 25%, rgba(255,255,255,0.08) 50%, rgba(255,255,255,0.04) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 8px;
    }
    @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

    /* â”€â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 1024px) {
      .sidebar { transform: translateX(-260px); }
      .sidebar.mobile-open { transform: translateX(0); }
      .main-content { margin-left: 0 !important; }
    }
    @media (max-width: 640px) {
      .stat-card .stat-value { font-size: 22px; }
      .page { padding: 16px; }
    }

    /* â”€â”€â”€ Sync Spinner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .spin { animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- TOAST CONTAINER                                                        -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SIDEBAR                                                                -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <aside class="sidebar" id="sidebar">
    <div style="padding: 20px 20px 12px; display: flex; align-items: center; gap: 12px;">
      <div style="width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,#ff6b35,#f7931e);display:flex;align-items:center;justify-content:center;font-size:20px;">ğŸ”¥</div>
      <div>
        <div style="font-size:16px;font-weight:800;letter-spacing:-0.5px;">Blaze<span style="color:var(--accent)">OS</span></div>
        <div style="font-size:10px;color:var(--text-secondary);font-weight:500;">ENTERPRISE v1.0</div>
      </div>
    </div>

    <div class="nav-section">Command Center</div>
    <div class="nav-item active" data-page="dashboard" onclick="navigateTo('dashboard')">
      <span>ğŸ“Š</span> Dashboard
    </div>
    <div class="nav-item" data-page="leads" onclick="navigateTo('leads')">
      <span>ğŸ¯</span> Leads
    </div>
    <div class="nav-item" data-page="agents" onclick="navigateTo('agents')">
      <span>ğŸ¤–</span> Agents
    </div>
    <div class="nav-item" data-page="tasks" onclick="navigateTo('tasks')">
      <span>ğŸ“‹</span> Tasks
    </div>

    <div class="nav-section">Integrations</div>
    <div class="nav-item" data-page="systeme" onclick="navigateTo('systeme')">
      <span>ğŸ”—</span> Systeme.io
    </div>

    <div class="nav-section">Midnight Magic</div>
    <div class="nav-item" data-page="tools" onclick="navigateTo('tools')">
      <span>ğŸ› ï¸</span> Tools (14)
    </div>

    <div class="nav-section">E-Commerce</div>
    <div class="nav-item" data-page="shopify" onclick="navigateTo('shopify')">
      <span>ğŸ›’</span> Shopify Stores
    </div>

    <div class="nav-section">Settings</div>
    <div class="nav-item" data-page="settings" onclick="navigateTo('settings')">
      <span>âš™ï¸</span> Configuration
    </div>

    <!-- Bottom user area -->
    <div style="position:absolute;bottom:0;left:0;right:0;padding:16px 20px;border-top:1px solid rgba(255,255,255,0.04);display:flex;align-items:center;gap:10px;">
      <div style="width:32px;height:32px;border-radius:8px;background:linear-gradient(135deg,#ff6b35,#f7931e);display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;">Z</div>
      <div>
        <div style="font-size:13px;font-weight:600;">Zain Moolla</div>
        <div style="font-size:11px;color:var(--text-secondary);">Blaze Ignite</div>
      </div>
    </div>
  </aside>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- MAIN CONTENT                                                           -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="main-content" id="mainContent">

    <!-- â”€â”€â”€ TOPBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="topbar">
      <div style="display:flex;align-items:center;gap:16px;">
        <button onclick="toggleSidebar()" style="background:none;border:none;color:var(--text-secondary);font-size:20px;cursor:pointer;">â˜°</button>
        <div>
          <div style="font-size:16px;font-weight:700;" id="pageTitle">Dashboard</div>
          <div style="font-size:11px;color:var(--text-secondary);" id="pageSubtitle">Command Center Overview</div>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:12px;">
        <span style="font-size:12px;color:var(--text-secondary);" id="liveTime"></span>
        <div id="apiStatus" style="display:flex;align-items:center;gap:6px;padding:4px 12px;border-radius:20px;font-size:11px;font-weight:600;background:rgba(239,68,68,0.1);color:#f87171;">
          <span style="width:6px;height:6px;border-radius:50%;background:currentColor;"></span>
          OFFLINE
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- PAGE: DASHBOARD                                                   -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page active" id="page-dashboard">
      <!-- Stats Row -->
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:24px;" id="statsGrid">
        <div class="glass stat-card stat-orange gradient-border">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;">
            <div>
              <div class="stat-label">Total Leads</div>
              <div class="stat-value" id="stat-leads">â€”</div>
            </div>
            <div class="stat-icon" style="background:rgba(255,107,53,0.12);">ğŸ¯</div>
          </div>
          <div style="margin-top:8px;font-size:11px;color:var(--success);font-weight:600;">â†‘ synced</div>
        </div>
        <div class="glass stat-card stat-green gradient-border">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;">
            <div>
              <div class="stat-label">Revenue (est.)</div>
              <div class="stat-value" id="stat-revenue">â€”</div>
            </div>
            <div class="stat-icon" style="background:rgba(34,197,94,0.12);">ğŸ’°</div>
          </div>
          <div style="margin-top:8px;font-size:11px;color:var(--success);font-weight:600;">from lead tiers</div>
        </div>
        <div class="glass stat-card stat-blue gradient-border">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;">
            <div>
              <div class="stat-label">Agents Active</div>
              <div class="stat-value" id="stat-agents">â€”</div>
            </div>
            <div class="stat-icon" style="background:rgba(59,130,246,0.12);">ğŸ¤–</div>
          </div>
          <div style="margin-top:8px;font-size:11px;color:var(--text-secondary);font-weight:600;">4 deployed</div>
        </div>
        <div class="glass stat-card stat-gold gradient-border">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;">
            <div>
              <div class="stat-label">Pending Tasks</div>
              <div class="stat-value" id="stat-tasks">â€”</div>
            </div>
            <div class="stat-icon" style="background:rgba(247,147,30,0.12);">ğŸ“‹</div>
          </div>
          <div style="margin-top:8px;font-size:11px;color:var(--warning);font-weight:600;">in queue</div>
        </div>
        <div class="glass stat-card stat-red gradient-border">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;">
            <div>
              <div class="stat-label">Hot Leads</div>
              <div class="stat-value" id="stat-hot">â€”</div>
            </div>
            <div class="stat-icon" style="background:rgba(239,68,68,0.12);">ğŸ”¥</div>
          </div>
          <div style="margin-top:8px;font-size:11px;color:var(--danger);font-weight:600;">ready to close</div>
        </div>
      </div>

      <!-- Agents Quick Status -->
      <div style="margin-bottom:24px;">
        <div style="font-size:14px;font-weight:700;margin-bottom:12px;">Agent Status</div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;" id="dashAgents">
          <!-- filled by JS -->
        </div>
      </div>

      <!-- Two columns: Recent Leads + Tasks -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div class="glass" style="padding:20px;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
            <div style="font-size:14px;font-weight:700;">Recent Leads</div>
            <button class="btn btn-xs btn-ghost" onclick="navigateTo('leads')">View All â†’</button>
          </div>
          <div id="dashRecentLeads">
            <div class="skeleton" style="height:36px;margin-bottom:8px;"></div>
            <div class="skeleton" style="height:36px;margin-bottom:8px;"></div>
            <div class="skeleton" style="height:36px;margin-bottom:8px;"></div>
          </div>
        </div>
        <div class="glass" style="padding:20px;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
            <div style="font-size:14px;font-weight:700;">Tasks</div>
            <button class="btn btn-xs btn-ghost" onclick="navigateTo('tasks')">View All â†’</button>
          </div>
          <div id="dashTasks">
            <div class="skeleton" style="height:36px;margin-bottom:8px;"></div>
            <div class="skeleton" style="height:36px;margin-bottom:8px;"></div>
            <div class="skeleton" style="height:36px;margin-bottom:8px;"></div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div style="margin-top:24px;display:flex;flex-wrap:wrap;gap:10px;">
        <button class="btn btn-primary" onclick="openAddLeadModal()">+ Add Lead</button>
        <button class="btn btn-ghost" onclick="triggerSync()">ğŸ”— Sync Systeme.io</button>
        <button class="btn btn-ghost" onclick="seedDatabase()">ğŸŒ± Seed Database</button>
        <button class="btn btn-ghost" onclick="loadAll()">ğŸ”„ Refresh</button>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- PAGE: LEADS                                                       -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-leads">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:12px;">
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn btn-xs btn-ghost filter-btn active" data-filter="ALL" onclick="filterLeads('ALL')">All</button>
          <button class="btn btn-xs btn-ghost filter-btn" data-filter="HOT" onclick="filterLeads('HOT')">ğŸ”¥ Hot</button>
          <button class="btn btn-xs btn-ghost filter-btn" data-filter="WARM" onclick="filterLeads('WARM')">ğŸŸ¡ Warm</button>
          <button class="btn btn-xs btn-ghost filter-btn" data-filter="COLD" onclick="filterLeads('COLD')">ğŸ”µ Cold</button>
          <button class="btn btn-xs btn-ghost filter-btn" data-filter="ICE" onclick="filterLeads('ICE')">ğŸ§Š Ice</button>
        </div>
        <div style="display:flex;gap:8px;">
          <input type="text" id="leadSearch" class="form-input" placeholder="Search leads..." style="width:220px;padding:6px 14px;font-size:13px;" oninput="searchLeads()">
          <button class="btn btn-primary btn-sm" onclick="openAddLeadModal()">+ Add Lead</button>
        </div>
      </div>
      <div class="glass" style="overflow-x:auto;">
        <table class="data-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Company</th>
              <th>Email</th>
              <th>Score</th>
              <th>Tier</th>
              <th>Source</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="leadsTableBody">
            <tr><td colspan="8" style="text-align:center;padding:40px;color:var(--text-secondary);">Loading leads...</td></tr>
          </tbody>
        </table>
      </div>
      <div style="margin-top:12px;font-size:12px;color:var(--text-secondary);" id="leadsCount"></div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- PAGE: AGENTS                                                      -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-agents">
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:16px;" id="agentsGrid">
        <!-- filled by JS -->
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- PAGE: TASKS                                                       -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-tasks">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
        <div style="display:flex;gap:8px;">
          <button class="btn btn-xs btn-ghost task-filter active" data-status="all" onclick="filterTasks('all')">All</button>
          <button class="btn btn-xs btn-ghost task-filter" data-status="pending" onclick="filterTasks('pending')">Pending</button>
          <button class="btn btn-xs btn-ghost task-filter" data-status="in-progress" onclick="filterTasks('in-progress')">In Progress</button>
          <button class="btn btn-xs btn-ghost task-filter" data-status="done" onclick="filterTasks('done')">Done</button>
        </div>
        <button class="btn btn-primary btn-sm" onclick="openAddTaskModal()">+ Add Task</button>
      </div>
      <div id="tasksList">
        <!-- filled by JS -->
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- PAGE: SYSTEME.IO                                                  -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-systeme">
      <div class="glass" style="padding:24px;margin-bottom:20px;">
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;">
          <div>
            <div style="font-size:18px;font-weight:700;">Systeme.io Integration</div>
            <div style="font-size:13px;color:var(--text-secondary);margin-top:4px;">Two-way contact sync between Firestore and Systeme.io</div>
          </div>
          <div style="display:flex;gap:8px;">
            <button class="btn btn-primary" onclick="triggerSync()" id="syncBtn">
              <span id="syncIcon">ğŸ”—</span> Full Sync
            </button>
            <button class="btn btn-ghost" onclick="pullSystemeContacts()">â¬‡ï¸ Pull Contacts</button>
          </div>
        </div>
      </div>
      <div class="glass" style="padding:20px;">
        <div style="font-size:14px;font-weight:700;margin-bottom:16px;">Systeme.io Contacts</div>
        <div id="systemeContacts">
          <div style="text-align:center;padding:40px;color:var(--text-secondary);">Click "Pull Contacts" to load from Systeme.io</div>
        </div>
      </div>
      <div class="glass" style="padding:20px;margin-top:16px;">
        <div style="font-size:14px;font-weight:700;margin-bottom:12px;">Sync Log</div>
        <div id="syncLog" style="font-family:monospace;font-size:12px;color:var(--text-secondary);max-height:200px;overflow-y:auto;">
          Waiting for sync...
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- PAGE: TOOLS (Midnight Magic)                                      -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-tools">
      <div style="margin-bottom:20px;">
        <div style="font-size:18px;font-weight:700;">Midnight Magic Tools</div>
        <div style="font-size:13px;color:var(--text-secondary);margin-top:4px;">14 power tools for your agency arsenal</div>
      </div>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px;" id="toolsGrid">
        <!-- filled by JS -->
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- PAGE: SHOPIFY STORES                                              -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-shopify">
      <div class="glass" style="padding:24px;margin-bottom:20px;">
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;">
          <div>
            <div style="font-size:18px;font-weight:700;">Shopify Stores</div>
            <div style="font-size:13px;color:var(--text-secondary);margin-top:4px;">Manage store connections & pull live metrics</div>
          </div>
          <div style="display:flex;gap:8px;">
            <button class="btn btn-primary" onclick="openAddStoreModal()">+ Connect Store</button>
            <button class="btn btn-ghost" onclick="loadStores()">ğŸ”„ Refresh</button>
          </div>
        </div>
      </div>
      
      <!-- Store Cards -->
      <div id="storesList" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(360px,1fr));gap:16px;">
        <div class="glass" style="padding:40px;text-align:center;color:var(--text-secondary);">
          <div style="font-size:48px;margin-bottom:16px;">ğŸ›’</div>
          <div style="font-size:14px;font-weight:600;margin-bottom:8px;">No stores connected yet</div>
          <div style="font-size:13px;margin-bottom:20px;">Connect your first Shopify store to see metrics</div>
          <button class="btn btn-primary" onclick="openAddStoreModal()">Connect Store</button>
        </div>
      </div>
      
      <!-- Sync Log -->
      <div class="glass" style="padding:20px;margin-top:16px;">
        <div style="font-size:14px;font-weight:700;margin-bottom:12px;">Store Sync Log</div>
        <div id="storeLog" style="font-family:monospace;font-size:12px;color:var(--text-secondary);max-height:200px;overflow-y:auto;">
          Waiting for store sync...
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- PAGE: SETTINGS                                                    -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-settings">
      <div class="glass" style="padding:24px;max-width:600px;">
        <div style="font-size:18px;font-weight:700;margin-bottom:20px;">Configuration</div>
        <div class="form-group">
          <label class="form-label">API Base URL</label>
          <input type="text" class="form-input" id="settingsApiUrl" value="" placeholder="Leave empty to use current domain (same as frontend)">
        </div>
        <div class="form-group">
          <label class="form-label">Systeme.io API Key</label>
          <input type="password" class="form-input" id="settingsSystemeKey" value="" placeholder="Enter API key">
        </div>
        <div class="form-group">
          <label class="form-label">HeyGen API Key</label>
          <input type="password" class="form-input" id="settingsHeygenKey" value="" placeholder="Enter API key">
        </div>
        <div style="display:flex;gap:10px;margin-top:20px;">
          <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
          <button class="btn btn-ghost" onclick="testConnection()">Test Connection</button>
        </div>
      </div>
    </div>

  </div><!-- end main-content -->

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- MODAL: ADD SHOPIFY STORE                                               -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="modal-overlay" id="addStoreModal">
    <div class="modal-content">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
        <div style="font-size:16px;font-weight:700;">Connect Shopify Store</div>
        <button onclick="closeModal('addStoreModal')" style="background:none;border:none;color:var(--text-secondary);font-size:20px;cursor:pointer;">âœ•</button>
      </div>
      <form onsubmit="submitStore(event)">
        <div class="form-group">
          <label class="form-label">Store Name *</label>
          <input type="text" class="form-input" id="storeName" required placeholder="My Store">
        </div>
        <div class="form-group">
          <label class="form-label">Store URL *</label>
          <input type="url" class="form-input" id="storeUrl" required placeholder="https://my-store.myshopify.com">
        </div>
        <div class="form-group">
          <label class="form-label">API Key / Access Token</label>
          <input type="password" class="form-input" id="storeApiKey" placeholder="shpat_xxxxxxxxxxxxxxxx">
        </div>
        <div class="form-group">
          <label class="form-label">Client Notes</label>
          <textarea class="form-input" id="storeNotes" rows="3" placeholder="Any notes about this store..."></textarea>
        </div>
        <div style="display:flex;gap:10px;margin-top:20px;">
          <button type="submit" class="btn btn-primary" style="flex:1;">Connect Store</button>
          <button type="button" class="btn btn-ghost" onclick="closeModal('addStoreModal')">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- MODAL: ADD LEAD                                                        -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="modal-overlay" id="addLeadModal">
    <div class="modal-content">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
        <div style="font-size:16px;font-weight:700;">Add New Lead</div>
        <button onclick="closeModal('addLeadModal')" style="background:none;border:none;color:var(--text-secondary);font-size:20px;cursor:pointer;">âœ•</button>
      </div>
      <form onsubmit="submitLead(event)">
        <div class="form-group">
          <label class="form-label">Name *</label>
          <input type="text" class="form-input" id="leadName" required placeholder="Full name">
        </div>
        <div class="form-group">
          <label class="form-label">Company</label>
          <input type="text" class="form-input" id="leadCompany" placeholder="Company name">
        </div>
        <div class="form-group">
          <label class="form-label">Email *</label>
          <input type="email" class="form-input" id="leadEmail" required placeholder="email@example.com">
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
          <div class="form-group">
            <label class="form-label">Score (0-100)</label>
            <input type="number" class="form-input" id="leadScore" min="0" max="100" value="50" placeholder="50">
          </div>
          <div class="form-group">
            <label class="form-label">Tier</label>
            <select class="form-input form-select" id="leadTier">
              <option value="HOT">ğŸ”¥ Hot</option>
              <option value="WARM" selected>ğŸŸ¡ Warm</option>
              <option value="COLD">ğŸ”µ Cold</option>
              <option value="ICE">ğŸ§Š Ice</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Source</label>
          <select class="form-input form-select" id="leadSource">
            <option value="manual">Manual Entry</option>
            <option value="linkedin">LinkedIn</option>
            <option value="instagram">Instagram</option>
            <option value="referral">Referral</option>
            <option value="website">Website</option>
            <option value="cold-email">Cold Email</option>
            <option value="systeme.io">Systeme.io</option>
            <option value="scraper">Scraper</option>
          </select>
        </div>
        <div style="display:flex;gap:10px;margin-top:20px;">
          <button type="submit" class="btn btn-primary" style="flex:1;">Add Lead</button>
          <button type="button" class="btn btn-ghost" onclick="closeModal('addLeadModal')">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- MODAL: ADD TASK                                                        -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="modal-overlay" id="addTaskModal">
    <div class="modal-content">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
        <div style="font-size:16px;font-weight:700;">Add New Task</div>
        <button onclick="closeModal('addTaskModal')" style="background:none;border:none;color:var(--text-secondary);font-size:20px;cursor:pointer;">âœ•</button>
      </div>
      <form onsubmit="submitTask(event)">
        <div class="form-group">
          <label class="form-label">Title *</label>
          <input type="text" class="form-input" id="taskTitle" required placeholder="Task description">
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
          <div class="form-group">
            <label class="form-label">Priority</label>
            <select class="form-input form-select" id="taskPriority">
              <option value="high">ğŸ”´ High</option>
              <option value="medium" selected>ğŸŸ¡ Medium</option>
              <option value="low">ğŸŸ¢ Low</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Assign Agent</label>
            <select class="form-input form-select" id="taskAgent">
              <option value="hunter">ğŸ¯ Hunter</option>
              <option value="outreach">ğŸ“§ Outreach</option>
              <option value="creator">ğŸ¨ Creator</option>
              <option value="whatsapp">ğŸ’¬ WhatsApp</option>
            </select>
          </div>
        </div>
        <div style="display:flex;gap:10px;margin-top:20px;">
          <button type="submit" class="btn btn-primary" style="flex:1;">Create Task</button>
          <button type="button" class="btn btn-ghost" onclick="closeModal('addTaskModal')">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SCRIPT RUNNER MODAL                                                    -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="modal-overlay" id="scriptModal">
    <div class="modal-content" style="max-width:800px;max-height:90vh;overflow-y:auto;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
        <div style="font-size:16px;font-weight:700;" id="scriptModalTitle">Run Script</div>
        <button onclick="closeScriptModal()" style="background:none;border:none;color:var(--text-secondary);font-size:20px;cursor:pointer;">âœ•</button>
      </div>
      
      <!-- Form State -->
      <div id="scriptForm">
        <div id="scriptFormContent"></div>
        <div style="display:flex;gap:10px;margin-top:20px;">
          <button class="btn btn-primary" onclick="runScript()" style="flex:1;">â–¶ Run Script</button>
          <button class="btn btn-ghost" onclick="closeScriptModal()">Cancel</button>
        </div>
      </div>
      
      <!-- Loading State -->
      <div id="scriptLoading" style="display:none;text-align:center;padding:40px;">
        <div style="font-size:48px;animation:pulse 1s infinite;">â³</div>
        <div style="margin-top:16px;font-size:14px;color:var(--text-secondary);">Running script...</div>
        <div style="margin-top:8px;font-size:12px;color:var(--text-secondary);opacity:0.6;">This may take a few seconds</div>
      </div>
      
      <!-- Results State -->
      <div id="scriptResults" style="display:none;">
        <div id="scriptResultsContent"></div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- CHAT FLOATING BUTTON                                                   -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="chat-fab" onclick="window.open('https://wa.me/+27615215148','_blank')" title="Chat with Blaze">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="white">
      <path d="M12 2C6.48 2 2 6.48 2 12c0 1.82.49 3.53 1.35 5L2 22l5.09-1.35A9.96 9.96 0 0012 22c5.52 0 10-4.48 10-10S17.52 2 12 2zm0 18c-1.66 0-3.22-.51-4.54-1.38l-.32-.21-3.02.8.8-2.94-.21-.32A7.93 7.93 0 014 12c0-4.42 3.58-8 8-8s8 3.58 8 8-3.58 8-8 8zm4.41-6.56l-1.13-.32c-.38-.1-.77-.02-1.1.24l-.82.64c-.28.22-.67.2-.93-.05l-1.17-1.17c-.25-.26-.27-.65-.05-.93l.64-.82c.26-.33.34-.72.24-1.1l-.32-1.13c-.17-.61-.71-1.03-1.35-.95-.64.08-1.16.52-1.33 1.13l-.32 1.13c-.22.77.03 1.58.63 2.12l2.83 2.83c.54.6 1.35.85 2.12.63l1.13-.32c.61-.17 1.05-.69 1.13-1.33.08-.64-.34-1.18-.95-1.35z"/>
    </svg>
  </div>
  
  <style>
    @keyframes pulse {
      0%,100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.05); }
    }
    .chat-fab {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, #25D366, #128C7E);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(37, 211, 102, 0.4);
      transition: all 0.2s;
      z-index: 999;
    }
    .chat-fab:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 30px rgba(37, 211, 102, 0.6);
    }
  </style>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- JAVASCRIPT                                                             -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script>
    // â”€â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let API_BASE = localStorage.getItem('blaze_api_url') || '';
    let allLeads = [];
    let allTasks = [];
    let allAgents = [];
    let currentFilter = 'ALL';
    let currentTaskFilter = 'all';

    // â”€â”€â”€ TOOLS DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const TOOLS = [
      { num: 1, name: 'Blaze Content Forge', desc: 'Instagram content generator â€” carousels, reels, captions', icon: 'ğŸ“¸', color: '#ff6b35', runnable: true, type: 'content' },
      { num: 2, name: 'Prospect Hunter', desc: 'Google search automation for finding leads', icon: 'ğŸ”', color: '#3b82f6', runnable: true, type: 'prospect' },
      { num: 3, name: 'Blaze Crystal Ball', desc: 'AI lead scoring predictor', icon: 'ğŸ”®', color: '#8b5cf6', runnable: true, type: 'score' },
      { num: 4, name: 'Blaze Battle Card', desc: 'Sales intelligence & competitor objection handling', icon: 'âš”ï¸', color: '#ef4444' },
      { num: 5, name: 'Blaze Competitor Tracker', desc: 'Shopify store monitoring & alerts', icon: 'ğŸ‘ï¸', color: '#f59e0b' },
      { num: 6, name: 'Blaze Proposal Forge', desc: 'Auto-generate client proposals', icon: 'ğŸ“„', color: '#22c55e' },
      { num: 7, name: 'Blaze Revenue Oracle', desc: 'MRR forecasting & revenue predictions', icon: 'ğŸ“ˆ', color: '#06b6d4' },
      { num: 8, name: 'Blaze Client Success', desc: 'Onboarding flows + progress reports', icon: 'ğŸ“', color: '#ec4899' },
      { num: 9, name: 'Blaze Lead Warmer', desc: 'Automated email sequences & nurture', icon: 'ğŸ”¥', color: '#f97316' },
      { num: 10, name: 'Blaze Campaign Architect', desc: 'Ad campaign generator (Meta, Google)', icon: 'ğŸ—ï¸', color: '#6366f1' },
      { num: 11, name: 'Blaze Social Guardian', desc: 'Social listening & brand monitoring', icon: 'ğŸ“¡', color: '#14b8a6' },
      { num: 12, name: 'Blaze Recipe Vault', desc: 'Winning ad creative recipes library', icon: 'ğŸ§ª', color: '#a855f7' },
      { num: 13, name: 'Blaze Veo 3.1', desc: 'AI video generation via HeyGen', icon: 'ğŸ¬', color: '#e11d48' },
      { num: 14, name: 'Shopify Auditor', desc: 'Automated store audits & reports', icon: 'ğŸ›’', color: '#84cc16' },
    ];

    // â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.addEventListener('DOMContentLoaded', () => {
      updateClock();
      setInterval(updateClock, 1000);
      renderTools();
      loadSettings();
      loadAll();
    });

    // â”€â”€â”€ NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function navigateTo(page) {
      const titles = {
        dashboard: ['Dashboard', 'Command Center Overview'],
        leads: ['Leads', 'Manage your pipeline'],
        agents: ['Agents', 'AI agent fleet status'],
        tasks: ['Tasks', 'Track work across agents'],
        systeme: ['Systeme.io', 'Contact sync & integration'],
        tools: ['Midnight Magic', '14 power tools'],
        shopify: ['Shopify Stores', 'E-commerce management'],
        settings: ['Settings', 'Configure connections']
      };
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      document.getElementById(`page-${page}`).classList.add('active');
      document.querySelector(`.nav-item[data-page="${page}"]`)?.classList.add('active');
      const [title, sub] = titles[page] || ['', ''];
      document.getElementById('pageTitle').textContent = title;
      document.getElementById('pageSubtitle').textContent = sub;
      // Close sidebar on mobile
      if (window.innerWidth <= 1024) {
        document.getElementById('sidebar').classList.remove('mobile-open');
      }
    }

    function toggleSidebar() {
      const sb = document.getElementById('sidebar');
      if (window.innerWidth <= 1024) {
        sb.classList.toggle('mobile-open');
      } else {
        sb.classList.toggle('sidebar-hidden');
        document.getElementById('mainContent').classList.toggle('main-full');
      }
    }

    // â”€â”€â”€ CLOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function updateClock() {
      const now = new Date();
      document.getElementById('liveTime').textContent = now.toLocaleTimeString('en-ZA', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }) + ' SAST';
    }

    // â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function showToast(msg, type = 'success') {
      const c = document.getElementById('toastContainer');
      const t = document.createElement('div');
      t.className = `toast toast-${type}`;
      t.textContent = msg;
      c.appendChild(t);
      setTimeout(() => t.remove(), 3000);
    }

    // â”€â”€â”€ API FETCH WRAPPER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function api(endpoint, options = {}) {
      const base = API_BASE || ''; // Empty = use relative URLs (same domain)
      const url = base ? `${base}${endpoint}` : endpoint;
      const res = await fetch(url, {
        headers: { 'Content-Type': 'application/json', ...options.headers },
        ...options
      });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const json = await res.json();
      // API returns {success: true, data: ...} format
      return json.data || json;
    }

    // â”€â”€â”€ LOAD ALL DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadAll() {
      try {
        await Promise.all([loadStats(), loadLeads(), loadAgents(), loadTasks()]);
        setApiStatus(true);
        showToast('Data loaded successfully', 'success');
      } catch (err) {
        console.error('Load error:', err);
        setApiStatus(false);
        showToast('Failed to connect: ' + err.message, 'error');
      }
    }

    function setApiStatus(online) {
      const el = document.getElementById('apiStatus');
      if (online) {
        el.innerHTML = '<span style="width:6px;height:6px;border-radius:50%;background:currentColor;"></span> ONLINE';
        el.style.background = 'rgba(34,197,94,0.1)';
        el.style.color = '#4ade80';
      } else {
        el.innerHTML = '<span style="width:6px;height:6px;border-radius:50%;background:currentColor;"></span> OFFLINE';
        el.style.background = 'rgba(239,68,68,0.1)';
        el.style.color = '#f87171';
      }
    }

    // â”€â”€â”€ STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadStats() {
      const data = await api('/api/stats');
      document.getElementById('stat-leads').textContent = data.totalLeads || 0;
      document.getElementById('stat-revenue').textContent = 'R' + (data.revenue || 0).toLocaleString();
      document.getElementById('stat-agents').textContent = data.totalAgents || 4;
      document.getElementById('stat-tasks').textContent = data.pendingTasks || 0;
      // Calculate hot leads
      const hotCount = allLeads.filter(l => l.tier === 'HOT').length;
      document.getElementById('stat-hot').textContent = hotCount;
    }

    // â”€â”€â”€ LEADS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadLeads() {
      const data = await api('/api/leads');
      allLeads = data || [];
      renderLeads(allLeads);
      renderDashRecentLeads(allLeads.slice(0, 5));
    }

    function renderLeads(leads) {
      const tbody = document.getElementById('leadsTableBody');
      if (!leads.length) {
        tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;padding:40px;color:var(--text-secondary);">No leads found</td></tr>';
        document.getElementById('leadsCount').textContent = '0 leads';
        return;
      }
      tbody.innerHTML = leads.map(l => {
        const scoreColor = l.score >= 80 ? '#22c55e' : l.score >= 50 ? '#f59e0b' : l.score >= 25 ? '#3b82f6' : '#8b8b9e';
        const tierClass = `badge-${l.tier?.toLowerCase() || 'cold'}`;
        return `<tr>
          <td style="font-weight:600;">${esc(l.name)}</td>
          <td style="color:var(--text-secondary);">${esc(l.company || 'â€”')}</td>
          <td style="font-size:13px;">${esc(l.email)}</td>
          <td>
            <div style="display:flex;align-items:center;gap:8px;">
              <span style="font-weight:600;color:${scoreColor};">${l.score}</span>
              <div class="score-bar"><div class="score-fill" style="width:${l.score}%;background:${scoreColor};"></div></div>
            </div>
          </td>
          <td><span class="badge ${tierClass}">${l.tier}</span></td>
          <td style="color:var(--text-secondary);font-size:13px;">${esc(l.source || 'â€”')}</td>
          <td style="color:var(--text-secondary);font-size:13px;">${esc(l.date || 'â€”')}</td>
          <td>
            <button class="btn btn-xs btn-danger" onclick="deleteLead('${l.id}')">âœ•</button>
          </td>
        </tr>`;
      }).join('');
      document.getElementById('leadsCount').textContent = `${leads.length} leads`;
    }

    function renderDashRecentLeads(leads) {
      const el = document.getElementById('dashRecentLeads');
      if (!leads.length) { el.innerHTML = '<div style="color:var(--text-secondary);font-size:13px;">No leads yet</div>'; return; }
      el.innerHTML = leads.map(l => {
        const tierClass = `badge-${l.tier?.toLowerCase() || 'cold'}`;
        return `<div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.03);">
          <div>
            <div style="font-size:13px;font-weight:600;">${esc(l.name)}</div>
            <div style="font-size:11px;color:var(--text-secondary);">${esc(l.company || '')}</div>
          </div>
          <span class="badge ${tierClass}" style="font-size:10px;">${l.tier}</span>
        </div>`;
      }).join('');
    }

    function filterLeads(tier) {
      currentFilter = tier;
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      document.querySelector(`.filter-btn[data-filter="${tier}"]`).classList.add('active');
      const filtered = tier === 'ALL' ? allLeads : allLeads.filter(l => l.tier === tier);
      renderLeads(filtered);
    }

    function searchLeads() {
      const q = document.getElementById('leadSearch').value.toLowerCase();
      const filtered = allLeads.filter(l =>
        (l.name || '').toLowerCase().includes(q) ||
        (l.company || '').toLowerCase().includes(q) ||
        (l.email || '').toLowerCase().includes(q)
      );
      renderLeads(currentFilter === 'ALL' ? filtered : filtered.filter(l => l.tier === currentFilter));
    }

    async function deleteLead(id) {
      if (!confirm('Delete this lead?')) return;
      try {
        await api(`/api/leads/${id}`, { method: 'DELETE' });
        showToast('Lead deleted', 'success');
        loadLeads();
        loadStats();
      } catch (err) {
        showToast('Delete failed: ' + err.message, 'error');
      }
    }

    // â”€â”€â”€ ADD LEAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function openAddLeadModal() { document.getElementById('addLeadModal').classList.add('show'); }
    function openAddTaskModal() { document.getElementById('addTaskModal').classList.add('show'); }
    function closeModal(id) { document.getElementById(id).classList.remove('show'); }

    async function submitLead(e) {
      e.preventDefault();
      const lead = {
        name: document.getElementById('leadName').value,
        company: document.getElementById('leadCompany').value,
        email: document.getElementById('leadEmail').value,
        score: parseInt(document.getElementById('leadScore').value) || 50,
        tier: document.getElementById('leadTier').value,
        source: document.getElementById('leadSource').value
      };
      try {
        await api('/api/leads', { method: 'POST', body: JSON.stringify(lead) });
        showToast('Lead added!', 'success');
        closeModal('addLeadModal');
        e.target.reset();
        loadLeads();
        loadStats();
      } catch (err) {
        showToast('Failed: ' + err.message, 'error');
      }
    }

    // â”€â”€â”€ AGENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadAgents() {
      const data = await api('/api/agents');
      allAgents = data || [];
      renderAgents(allAgents);
      renderDashAgents(allAgents);
    }

    function renderAgents(agents) {
      const grid = document.getElementById('agentsGrid');
      grid.innerHTML = agents.map(a => {
        const statusClass = a.status === 'running' ? 'status-running' : a.status === 'error' ? 'status-error' : 'status-idle';
        return `<div class="glass agent-card gradient-border">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;">
            <div style="display:flex;align-items:center;gap:12px;">
              <div style="font-size:28px;">ğŸ¤–</div>
              <div>
                <div style="font-size:15px;font-weight:700;">${esc(a.name)}</div>
                <div style="font-size:12px;color:var(--text-secondary);margin-top:2px;">AI Agent</div>
              </div>
            </div>
            <div style="display:flex;align-items:center;gap:6px;">
              <span class="agent-status ${statusClass}"></span>
              <span style="font-size:11px;font-weight:600;text-transform:uppercase;color:${a.status === 'running' ? 'var(--success)' : a.status === 'error' ? 'var(--danger)' : 'var(--text-secondary)'}">${a.status}</span>
            </div>
          </div>
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div>
              <div style="font-size:24px;font-weight:800;">${(a.stats?.found || 0).toLocaleString()}</div>
              <div style="font-size:11px;color:var(--text-secondary);">Actions</div>
            </div>
            <button class="btn btn-sm ${a.status === 'running' ? 'btn-danger' : 'btn-primary'}" onclick="toggleAgent('${a.id}','${a.status}')">
              ${a.status === 'running' ? 'â¸ Pause' : 'â–¶ Start'}
            </button>
          </div>
        </div>`;
      }).join('');
    }

    function renderDashAgents(agents) {
      const el = document.getElementById('dashAgents');
      el.innerHTML = agents.map(a => {
        const statusClass = a.status === 'running' ? 'status-running' : 'status-idle';
        return `<div class="glass" style="padding:14px;display:flex;align-items:center;gap:12px;">
          <span style="font-size:20px;">ğŸ¤–</span>
          <div style="flex:1;">
            <div style="font-size:13px;font-weight:600;">${esc(a.name)}</div>
          </div>
          <span class="agent-status ${statusClass}"></span>
        </div>`;
      }).join('');
    }

    async function toggleAgent(id, current) {
      const newStatus = current === 'running' ? 'idle' : 'running';
      try {
        await api(`/api/agents/${id}`, { method: 'PUT', body: JSON.stringify({ status: newStatus }) });
        showToast(`Agent ${newStatus === 'running' ? 'started' : 'paused'}`, 'success');
        loadAgents();
      } catch (err) {
        showToast('Failed: ' + err.message, 'error');
      }
    }

    // â”€â”€â”€ TASKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadTasks() {
      const data = await api('/api/tasks');
      allTasks = data || [];
      renderTasks(allTasks);
      renderDashTasks(allTasks.filter(t => t.status !== 'done').slice(0, 4));
    }

    function renderTasks(tasks) {
      const el = document.getElementById('tasksList');
      const filtered = currentTaskFilter === 'all' ? tasks : tasks.filter(t => t.status === currentTaskFilter);
      if (!filtered.length) {
        el.innerHTML = '<div class="glass" style="padding:40px;text-align:center;color:var(--text-secondary);">No tasks found</div>';
        return;
      }
      el.innerHTML = filtered.map(t => {
        const priColor = t.priority === 'high' ? 'var(--danger)' : t.priority === 'medium' ? 'var(--warning)' : 'var(--success)';
        const statusBg = t.status === 'done' ? 'rgba(34,197,94,0.1)' : t.status === 'in-progress' ? 'rgba(59,130,246,0.1)' : 'rgba(255,255,255,0.04)';
        return `<div class="glass" style="padding:16px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;background:${statusBg};">
          <div style="display:flex;align-items:center;gap:12px;flex:1;min-width:200px;">
            <div style="width:8px;height:8px;border-radius:50%;background:${priColor};flex-shrink:0;"></div>
            <div>
              <div style="font-size:14px;font-weight:600;${t.status === 'done' ? 'text-decoration:line-through;opacity:0.5;' : ''}">${esc(t.title)}</div>
              <div style="font-size:11px;color:var(--text-secondary);margin-top:2px;">${esc(t.priority)} priority</div>
            </div>
          </div>
          <div style="display:flex;gap:6px;">
            ${t.status !== 'done' ? `<button class="btn btn-xs btn-ghost" onclick="updateTask('${t.id}','${t.status === 'pending' ? 'in-progress' : 'done'}')">
              ${t.status === 'pending' ? 'â–¶ Start' : 'âœ“ Done'}
            </button>` : ''}
            <button class="btn btn-xs btn-danger" onclick="deleteTask('${t.id}')">âœ•</button>
          </div>
        </div>`;
      }).join('');
    }

    function renderDashTasks(tasks) {
      const el = document.getElementById('dashTasks');
      if (!tasks.length) { el.innerHTML = '<div style="color:var(--text-secondary);font-size:13px;">No pending tasks</div>'; return; }
      el.innerHTML = tasks.map(t => {
        const priColor = t.priority === 'high' ? 'var(--danger)' : t.priority === 'medium' ? 'var(--warning)' : 'var(--success)';
        return `<div style="display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.03);">
          <div style="width:6px;height:6px;border-radius:50%;background:${priColor};flex-shrink:0;"></div>
          <div style="font-size:13px;flex:1;">${esc(t.title)}</div>
          <span style="font-size:10px;color:var(--text-secondary);">${esc(t.status)}</span>
        </div>`;
      }).join('');
    }

    function filterTasks(status) {
      currentTaskFilter = status;
      document.querySelectorAll('.task-filter').forEach(b => b.classList.remove('active'));
      document.querySelector(`.task-filter[data-status="${status}"]`).classList.add('active');
      renderTasks(allTasks);
    }

    async function submitTask(e) {
      e.preventDefault();
      const task = {
        title: document.getElementById('taskTitle').value,
        priority: document.getElementById('taskPriority').value,
        status: 'pending'
      };
      try {
        await api('/api/tasks', { method: 'POST', body: JSON.stringify(task) });
        showToast('Task created!', 'success');
        closeModal('addTaskModal');
        e.target.reset();
        loadTasks();
        loadStats();
      } catch (err) {
        showToast('Failed: ' + err.message, 'error');
      }
    }

    async function updateTask(id, status) {
      try {
        await api(`/api/tasks/${id}`, { method: 'PUT', body: JSON.stringify({ status }) });
        showToast('Task updated', 'success');
        loadTasks();
        loadStats();
      } catch (err) {
        showToast('Failed: ' + err.message, 'error');
      }
    }

    async function deleteTask(id) {
      if (!confirm('Delete this task?')) return;
      try {
        await api(`/api/tasks/${id}`, { method: 'DELETE' });
        showToast('Task deleted', 'success');
        loadTasks();
        loadStats();
      } catch (err) {
        showToast('Failed: ' + err.message, 'error');
      }
    }

    // â”€â”€â”€ SYSTEME.IO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function pullSystemeContacts() {
      try {
        showToast('Pulling contacts from Systeme.io...', 'info');
        const data = await api('/api/systeme/contacts');
        const contacts = data?.items || data || [];
        const el = document.getElementById('systemeContacts');
        if (!contacts.length) {
          el.innerHTML = '<div style="color:var(--text-secondary);text-align:center;padding:20px;">No contacts found in Systeme.io</div>';
          return;
        }
        el.innerHTML = `<table class="data-table"><thead><tr><th>Email</th><th>Name</th><th>Tags</th></tr></thead><tbody>
          ${contacts.map(c => `<tr>
            <td>${esc(c.email || 'â€”')}</td>
            <td>${esc(c.name || c.fields?.find(f => f.slug === 'first_name')?.value || 'â€”')}</td>
            <td style="font-size:12px;color:var(--text-secondary);">${(c.tags || []).map(t => t.name || t).join(', ') || 'â€”'}</td>
          </tr>`).join('')}
        </tbody></table>`;
        showToast(`Loaded ${contacts.length} contacts`, 'success');
      } catch (err) {
        showToast('Pull failed: ' + err.message, 'error');
      }
    }

    async function triggerSync() {
      const btn = document.getElementById('syncBtn');
      const icon = document.getElementById('syncIcon');
      btn.disabled = true;
      icon.classList.add('spin');
      icon.textContent = 'âŸ³';
      const log = document.getElementById('syncLog');
      log.innerHTML = `[${new Date().toLocaleTimeString()}] Starting two-way sync...\n`;

      try {
        const result = await api('/api/systeme/sync', { method: 'POST' });
        log.innerHTML += `[${new Date().toLocaleTimeString()}] Pulled: ${result.pulled || 0} contacts from Systeme.io\n`;
        log.innerHTML += `[${new Date().toLocaleTimeString()}] Imported: ${result.imported || 0} new leads\n`;
        log.innerHTML += `[${new Date().toLocaleTimeString()}] Skipped: ${result.skipped || 0} (already exist)\n`;
        log.innerHTML += `[${new Date().toLocaleTimeString()}] âœ… Sync complete!\n`;
        showToast(`Sync done: ${result.imported || 0} imported`, 'success');
        loadLeads();
        loadStats();
      } catch (err) {
        log.innerHTML += `[${new Date().toLocaleTimeString()}] âŒ Error: ${err.message}\n`;
        showToast('Sync failed: ' + err.message, 'error');
      }
      btn.disabled = false;
      icon.classList.remove('spin');
      icon.textContent = 'ğŸ”—';
    }

    // â”€â”€â”€ TOOLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let currentScriptType = null;
    let scriptResults = null;

    function renderTools() {
      const grid = document.getElementById('toolsGrid');
      grid.innerHTML = TOOLS.map(t => `
        <div class="glass tool-card gradient-border" ${t.runnable ? `onclick="openScriptModal('${t.type}', '${t.name}')"` : `onclick="showToast('${t.name} â€” coming soon','info')"`}>
          <div class="tool-number">${String(t.num).padStart(2,'0')}</div>
          <div style="font-size:28px;margin-bottom:12px;">${t.icon}</div>
          <div style="font-size:14px;font-weight:700;margin-bottom:4px;">${t.name}</div>
          <div style="font-size:12px;color:var(--text-secondary);line-height:1.5;">${t.desc}</div>
          <div style="margin-top:12px;display:flex;align-items:center;gap:6px;">
            <div style="width:6px;height:6px;border-radius:50%;background:${t.color};"></div>
            <span style="font-size:10px;color:var(--text-secondary);font-weight:600;">${t.runnable ? 'â–¶ CLICK TO RUN' : 'READY'}</span>
          </div>
        </div>
      `).join('');
    }

    // â”€â”€â”€ SCRIPT RUNNER MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function openScriptModal(type, name) {
      currentScriptType = type;
      document.getElementById('scriptModalTitle').textContent = name;
      document.getElementById('scriptModal').classList.add('show');
      document.getElementById('scriptForm').style.display = 'block';
      document.getElementById('scriptResults').style.display = 'none';
      document.getElementById('scriptLoading').style.display = 'none';
      
      // Show appropriate form fields
      const form = document.getElementById('scriptFormContent');
      if (type === 'prospect') {
        form.innerHTML = `
          <div class="form-group">
            <label class="form-label">Search Query</label>
            <input type="text" class="form-input" id="prospectQuery" placeholder="e-commerce store owner cape town" value="e-commerce store owner cape town">
          </div>
          <div class="form-group">
            <label class="form-label">Max Results</label>
            <input type="number" class="form-input" id="prospectMax" value="20" min="5" max="100">
          </div>
        `;
      } else if (type === 'content') {
        form.innerHTML = `
          <div class="form-group">
            <label class="form-label">Brand/Product</label>
            <input type="text" class="form-input" id="contentBrand" placeholder="Essora Skincare" value="Essora Skincare">
          </div>
          <div class="form-group">
            <label class="form-label">Post Type</label>
            <select class="form-input form-select" id="contentType">
              <option value="carousel">ğŸ“Š Tips Carousel</option>
              <option value="single">ğŸ“¸ Single Post</option>
              <option value="reel">ğŸ¬ Reel Script</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Topic</label>
            <input type="text" class="form-input" id="contentTopic" placeholder="5 skincare mistakes" value="5 skincare mistakes">
          </div>
        `;
      } else if (type === 'score') {
        form.innerHTML = `
          <div class="form-group">
            <label class="form-label">Select Lead to Score</label>
            <select class="form-input form-select" id="scoreLead">
              ${allLeads.slice(0,10).map(l => `<option value="${l.id}">${l.name} (${l.company || 'No company'})</option>`).join('') || '<option>No leads available</option>'}
            </select>
          </div>
        `;
      }
    }

    async function runScript() {
      const loading = document.getElementById('scriptLoading');
      const form = document.getElementById('scriptForm');
      const results = document.getElementById('scriptResults');
      
      form.style.display = 'none';
      loading.style.display = 'block';
      
      // Simulate script execution (replace with real API calls)
      await new Promise(r => setTimeout(r, 2000));
      
      let resultData = {};
      
      if (currentScriptType === 'prospect') {
        const query = document.getElementById('prospectQuery').value;
        resultData = {
          title: 'Prospect Hunter Results',
          summary: `Found 12 leads for "${query}"`,
          data: [
            { name: 'Sarah Johnson', company: 'Glow Beauty Co', email: 'sarah@glowbeauty.co.za', source: 'LinkedIn' },
            { name: 'Mike Peters', company: 'Cape Eats', email: 'mike@capeeats.com', source: 'Google' },
            { name: 'Lisa van der Merwe', company: 'Fashion Forward', email: 'lisa@fashionfwd.co.za', source: 'Instagram' },
            { name: 'David Nkosi', company: 'Tech Solutions', email: 'david@techsolutions.co.za', source: 'LinkedIn' },
            { name: 'Emma Wilson', company: 'Organic Foods SA', email: 'emma@organicfoods.co.za', source: 'Google' },
          ]
        };
      } else if (currentScriptType === 'content') {
        const brand = document.getElementById('contentBrand').value;
        const topic = document.getElementById('contentTopic').value;
        resultData = {
          title: 'Content Forge Results',
          summary: `Generated content for ${brand}`,
          data: {
            caption: `âœ¨ ${topic.toUpperCase()} âœ¨\n\nSwipe to see the mistakes that are ruining your skin! ğŸ‘‰\n\nWhich one are you guilty of? Comment below! ğŸ‘‡\n\n#skincare #beauty #${brand.replace(/\s+/g, '')}`,
            hashtags: '#skincare #beautytips #glowingskin #skincareroutine #beauty #selfcare #skincareproducts #healthyskin #skincaretips #glowup',
            slides: ['Slide 1: Hook', 'Slide 2: Mistake #1', 'Slide 3: Mistake #2', 'Slide 4: Mistake #3', 'Slide 5: CTA']
          }
        };
      } else if (currentScriptType === 'score') {
        const leadId = document.getElementById('scoreLead').value;
        const lead = allLeads.find(l => l.id === leadId);
        const score = Math.floor(Math.random() * 40) + 60; // 60-100
        const tier = score >= 80 ? 'HOT' : score >= 60 ? 'WARM' : 'COLD';
        resultData = {
          title: 'Crystal Ball Score',
          summary: `${lead?.name || 'Lead'} scored ${score}/100 â€” ${tier}`,
          data: {
            score,
            tier,
            factors: [
              'âœ… Email domain is corporate (+15)',
              'âœ… Company size matches ideal profile (+20)',
              'âœ… Recent engagement detected (+10)',
              'âš ï¸ No phone number (-5)'
            ],
            recommendation: tier === 'HOT' ? 'ğŸ”¥ PRIORITY: Contact within 24 hours' : 'â™¨ï¸ NURTURE: Add to email sequence'
          }
        };
      }
      
      scriptResults = resultData;
      displayScriptResults(resultData);
      
      loading.style.display = 'none';
      results.style.display = 'block';
      
      showToast('âœ… Script completed successfully!', 'success');
    }

    function displayScriptResults(data) {
      const container = document.getElementById('scriptResultsContent');
      
      if (Array.isArray(data.data)) {
        // Table format for list data
        container.innerHTML = `
          <div style="margin-bottom:16px;">
            <div style="font-size:18px;font-weight:700;">${data.title}</div>
            <div style="color:var(--success);font-size:14px;">${data.summary}</div>
          </div>
          <table class="data-table" style="margin-bottom:16px;">
            <thead>
              <tr><th>Name</th><th>Company</th><th>Email</th><th>Source</th></tr>
            </thead>
            <tbody>
              ${data.data.map(item => `
                <tr>
                  <td>${esc(item.name)}</td>
                  <td>${esc(item.company)}</td>
                  <td>${esc(item.email)}</td>
                  <td>${esc(item.source)}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
          <div style="display:flex;gap:10px;">
            <button class="btn btn-primary" onclick="addResultsToLeads()">â• Add All to Leads</button>
            <button class="btn btn-ghost" onclick="downloadResults()">â¬‡ï¸ Download CSV</button>
          </div>
        `;
      } else {
        // Object format for structured data
        container.innerHTML = `
          <div style="margin-bottom:16px;">
            <div style="font-size:18px;font-weight:700;">${data.title}</div>
            <div style="color:var(--success);font-size:14px;">${data.summary}</div>
          </div>
          <div class="glass" style="padding:16px;margin-bottom:16px;background:rgba(34,197,94,0.05);border:1px solid rgba(34,197,94,0.2);">
            <pre style="white-space:pre-wrap;font-family:inherit;font-size:13px;color:var(--text-primary);margin:0;">${typeof data.data === 'object' ? JSON.stringify(data.data, null, 2) : data.data}</pre>
          </div>
          <div style="display:flex;gap:10px;">
            <button class="btn btn-primary" onclick="copyResults()">ğŸ“‹ Copy Results</button>
            <button class="btn btn-ghost" onclick="runScript()">ğŸ”„ Run Again</button>
          </div>
        `;
      }
    }

    function closeScriptModal() {
      document.getElementById('scriptModal').classList.remove('show');
      currentScriptType = null;
      scriptResults = null;
    }

    function addResultsToLeads() {
      if (!scriptResults || !Array.isArray(scriptResults.data)) return;
      
      let added = 0;
      scriptResults.data.forEach(item => {
        // Check if email already exists
        const exists = allLeads.some(l => l.email === item.email);
        if (!exists) {
          allLeads.push({
            id: Date.now().toString() + Math.random(),
            name: item.name,
            company: item.company,
            email: item.email,
            score: 30,
            tier: 'COLD',
            source: 'prospect-hunter',
            date: new Date().toISOString().split('T')[0],
            createdAt: new Date().toISOString()
          });
          added++;
        }
      });
      
      showToast(`âœ… Added ${added} new leads!`, 'success');
      renderLeads(allLeads);
      closeScriptModal();
    }

    function downloadResults() {
      if (!scriptResults) return;
      const csv = 'Name,Company,Email,Source\n' + 
        scriptResults.data.map(r => `${r.name},${r.company},${r.email},${r.source}`).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `prospects-${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      showToast('âœ… CSV downloaded!', 'success');
    }

    function copyResults() {
      if (!scriptResults) return;
      navigator.clipboard.writeText(JSON.stringify(scriptResults.data, null, 2));
      showToast('âœ… Copied to clipboard!', 'success');
    }

    // â”€â”€â”€ SEED DATABASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function seedDatabase() {
      try {
        showToast('Seeding database...', 'info');
        await api('/api/seed');
        showToast('Database seeded!', 'success');
        loadAll();
      } catch (err) {
        showToast('Seed failed: ' + err.message, 'error');
      }
    }

    // â”€â”€â”€ SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function loadSettings() {
      document.getElementById('settingsApiUrl').value = API_BASE;
      document.getElementById('settingsSystemeKey').value = localStorage.getItem('blaze_systeme_key') || 'gutxuny6z7abcijjhr16yqazqltx43z5gqcl8jpo12mibokr31js1hfc0ed8i8k2';
      document.getElementById('settingsHeygenKey').value = localStorage.getItem('blaze_heygen_key') || '';
    }

    function saveSettings() {
      API_BASE = document.getElementById('settingsApiUrl').value.replace(/\/$/, '');
      localStorage.setItem('blaze_api_url', API_BASE);
      localStorage.setItem('blaze_systeme_key', document.getElementById('settingsSystemeKey').value);
      localStorage.setItem('blaze_heygen_key', document.getElementById('settingsHeygenKey').value);
      showToast('Settings saved!', 'success');
      if (API_BASE) loadAll();
    }

    async function testConnection() {
      saveSettings();
      try {
        await api('/api/stats');
        showToast('Connection successful!', 'success');
        setApiStatus(true);
      } catch (err) {
        showToast('Connection failed: ' + err.message, 'error');
        setApiStatus(false);
      }
    }

    // â”€â”€â”€ SHOPIFY STORES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let allStores = [];

    async function loadStores() {
      try {
        const data = await api('/api/stores');
        allStores = data || [];
        renderStores(allStores);
      } catch (err) {
        // If API doesn't exist yet, show empty state
        renderStores([]);
      }
    }

    function renderStores(stores) {
      const container = document.getElementById('storesList');
      if (!stores || stores.length === 0) {
        container.innerHTML = `
          <div class="glass" style="padding:40px;text-align:center;color:var(--text-secondary);">
            <div style="font-size:48px;margin-bottom:16px;">ğŸ›’</div>
            <div style="font-size:14px;font-weight:600;margin-bottom:8px;">No stores connected yet</div>
            <div style="font-size:13px;margin-bottom:20px;">Connect your first Shopify store to see metrics</div>
            <button class="btn btn-primary" onclick="openAddStoreModal()">Connect Store</button>
          </div>
        `;
        return;
      }
      
      container.innerHTML = stores.map(s => `
        <div class="glass gradient-border" style="padding:20px;">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;">
            <div style="display:flex;align-items:center;gap:12px;">
              <div style="font-size:32px;">ğŸ›’</div>
              <div>
                <div style="font-size:16px;font-weight:700;">${esc(s.name)}</div>
                <div style="font-size:12px;color:var(--text-secondary);">${esc(s.url)}</div>
              </div>
            </div>
            <span class="badge badge-${s.status === 'active' ? 'hot' : 'cold'}">${s.status || 'pending'}</span>
          </div>
          
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px;">
            <div class="glass" style="padding:12px;text-align:center;">
              <div style="font-size:20px;font-weight:800;color:var(--accent);">${s.metrics?.products || 0}</div>
              <div style="font-size:11px;color:var(--text-secondary);">Products</div>
            </div>
            <div class="glass" style="padding:12px;text-align:center;">
              <div style="font-size:20px;font-weight:800;color:var(--success);">${s.metrics?.orders || 0}</div>
              <div style="font-size:11px;color:var(--text-secondary);">Orders</div>
            </div>
            <div class="glass" style="padding:12px;text-align:center;">
              <div style="font-size:20px;font-weight:800;color:var(--info);">R${(s.metrics?.revenue || 0).toLocaleString()}</div>
              <div style="font-size:11px;color:var(--text-secondary);">Revenue</div>
            </div>
          </div>
          
          <div style="display:flex;gap:8px;">
            <button class="btn btn-sm btn-ghost" onclick="syncStore('${s.id}')">ğŸ”„ Sync</button>
            <button class="btn btn-sm btn-primary" onclick="runAudit('${s.id}')">ğŸ“Š Audit</button>
            <button class="btn btn-sm btn-danger" style="margin-left:auto;" onclick="deleteStore('${s.id}')">âœ•</button>
          </div>
          
          ${s.notes ? `<div style="margin-top:12px;padding:10px;background:rgba(255,255,255,0.03);border-radius:8px;font-size:12px;color:var(--text-secondary);">
            ${esc(s.notes)}
          </div>` : ''}
        </div>
      `).join('');
    }

    function openAddStoreModal() {
      document.getElementById('addStoreModal').classList.add('show');
    }

    async function submitStore(e) {
      e.preventDefault();
      const store = {
        name: document.getElementById('storeName').value,
        url: document.getElementById('storeUrl').value,
        apiKey: document.getElementById('storeApiKey').value,
        notes: document.getElementById('storeNotes').value,
        status: 'pending'
      };
      
      try {
        await api('/api/stores', { method: 'POST', body: JSON.stringify(store) });
        showToast('Store connected!', 'success');
        closeModal('addStoreModal');
        e.target.reset();
        loadStores();
        
        // Add to log
        const log = document.getElementById('storeLog');
        log.innerHTML += `[${new Date().toLocaleTimeString()}] âœ… Connected: ${store.name}\n`;
      } catch (err) {
        showToast('Failed: ' + err.message, 'error');
      }
    }

    async function syncStore(id) {
      const log = document.getElementById('storeLog');
      log.innerHTML += `[${new Date().toLocaleTimeString()}] ğŸ”„ Syncing store ${id}...\n`;
      showToast('Syncing store...', 'info');
      
      try {
        await api(`/api/stores/${id}/sync`, { method: 'POST' });
        showToast('Store synced!', 'success');
        loadStores();
        log.innerHTML += `[${new Date().toLocaleTimeString()}] âœ… Sync complete\n`;
      } catch (err) {
        showToast('Sync failed: ' + err.message, 'error');
        log.innerHTML += `[${new Date().toLocaleTimeString()}] âŒ Error: ${err.message}\n`;
      }
    }

    async function runAudit(id) {
      const store = allStores.find(s => s.id === id);
      showToast(`Running audit for ${store?.name}...`, 'info');
      
      const log = document.getElementById('storeLog');
      log.innerHTML += `[${new Date().toLocaleTimeString()}] ğŸ” Auditing ${store?.name}...\n`;
      
      // Simulate audit
      setTimeout(() => {
        log.innerHTML += `[${new Date().toLocaleTimeString()}] âœ… Audit complete - Score: 78/100\n`;
        showToast('Audit complete! Score: 78/100', 'success');
      }, 1500);
    }

    async function deleteStore(id) {
      if (!confirm('Remove this store?')) return;
      try {
        await api(`/api/stores/${id}`, { method: 'DELETE' });
        showToast('Store removed', 'success');
        loadStores();
      } catch (err) {
        showToast('Failed: ' + err.message, 'error');
      }
    }

    // â”€â”€â”€ UTILITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function esc(str) {
      if (!str) return '';
      const d = document.createElement('div');
      d.textContent = str;
      return d.innerHTML;
    }
  </script>
</body>
</html>