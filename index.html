<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blaze Business OS</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Clerk -->
    <script async crossorigin="anonymous" 
        data-clerk-publishable-key="pk_test_YWJvdmUtd2hpcHBldC0zNi5jbGVyay5hY2NvdW50cy5kZXYk"
        src="https://above-whippet-36.clerk.accounts.dev/npm/@clerk/clerk-js@4/dist/clerk.browser.js"
        type="text/javascript">
    </script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        background: '#0A0A0B',
                        card: '#131316',
                        accent: '#8B5CF6',
                        'accent-hover': '#7C3AED',
                    }
                }
            }
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: #0A0A0B;
            color: white;
            overflow: hidden;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .glass-card {
            background: rgba(19, 19, 22, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.06);
        }
        
        .glow { box-shadow: 0 0 20px rgba(139, 92, 246, 0.15); }
        
        .gradient-text {
            background: linear-gradient(135deg, #8B5CF6 0%, #A78BFA 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        .dragging { opacity: 0.5; transform: scale(1.02) rotate(2deg); }
        
        .kanban-column { min-height: 200px; transition: all 0.2s; }
        .kanban-column.drag-over {
            background: rgba(139, 92, 246, 0.1);
            border: 2px dashed rgba(139, 92, 246, 0.3);
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(139, 92, 246, 0.5); }
            50% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.8); }
        }
        .animate-pulse-glow { animation: pulse-glow 2s infinite; }
        
        /* Chat styles */
        .chat-message {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 16px;
            margin-bottom: 12px;
        }
        .chat-user { background: #8B5CF6; margin-left: auto; }
        .chat-assistant { background: rgba(255,255,255,0.1); }
        
        /* Progress bar animation */
        @keyframes progress-shine {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .progress-animated {
            background: linear-gradient(90deg, #8B5CF6 0%, #A78BFA 50%, #8B5CF6 100%);
            background-size: 200% 100%;
            animation: progress-shine 2s linear infinite;
        }
    </style>
</head>
<body class="bg-[#0A0A0B] text-white antialiased">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useContext, createContext, useRef } = React;
        
        // API Configuration
        const API_URL = 'https://blaze-business-os-prod.onrender.com';
        
        // --- Icons Component ---
        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [name]);
            return <i data-lucide={name} width={size} height={size} className={className}></i>;
        };

        // --- Storage ---
        const Storage = {
            get: (key, defaultValue) => {
                try {
                    const item = localStorage.getItem(key);
                    return item ? JSON.parse(item) : defaultValue;
                } catch (e) { return defaultValue; }
            },
            set: (key, value) => localStorage.setItem(key, JSON.stringify(value))
        };

        // --- Mock Data ---
        const defaultTasks = [
            { id: '1', title: 'Review Q4 Marketing Plan', description: 'Analyze performance metrics', status: 'todo', priority: 'high', assignee: 'JD', dueDate: '2024-02-15' },
            { id: '2', title: 'Update Shopify Product Feed', description: 'Sync inventory with store', status: 'inprogress', priority: 'medium', assignee: 'AS', dueDate: '2024-02-12' },
            { id: '3', title: 'Hunter Agent Configuration', description: 'Set up lead scoring rules', status: 'review', priority: 'high', assignee: 'MK', dueDate: '2024-02-10' },
            { id: '4', title: 'Client Report Generation', description: 'Monthly analytics report', status: 'done', priority: 'low', assignee: 'TL', dueDate: '2024-02-08' }
        ];

        const defaultAgents = [
            { id: 'hunter', name: 'Hunter Agent', description: 'Daily lead discovery', type: 'hunter', status: 'running', lastRun: '2 min ago', progress: 100, stats: { found: 10, qualified: 8 }, color: 'from-orange-500 to-red-500', subAgents: [
                { id: 'hunter-1', name: 'Store Scraper', role: 'Scraper', progress: 100, status: 'completed' },
                { id: 'hunter-2', name: 'Email Finder', role: 'Finder', progress: 100, status: 'completed' }
            ]},
            { id: 'outreach', name: 'Outreach Agent', description: 'Cold email campaigns', type: 'outreach', status: 'running', lastRun: '15 min ago', progress: 45, stats: { sent: 23, opened: 8 }, color: 'from-blue-500 to-cyan-500', subAgents: [
                { id: 'outreach-1', name: 'Template Engine', role: 'Writer', progress: 100, status: 'completed' },
                { id: 'outreach-2', name: 'Email Sender', role: 'Sender', progress: 45, status: 'working' }
            ]},
            { id: 'creator', name: 'Creator Agent', description: 'Instagram content', type: 'creator', status: 'running', lastRun: '5 min ago', progress: 78, stats: { posts: 2, stories: 4 }, color: 'from-pink-500 to-purple-500', subAgents: [
                { id: 'creator-1', name: 'Image Gen', role: 'Designer', progress: 80, status: 'working' },
                { id: 'creator-2', name: 'Caption Writer', role: 'Writer', progress: 100, status: 'completed' }
            ]},
            { id: 'auditor', name: 'Auditor Agent', description: 'Store audits (50+ checks)', type: 'auditor', status: 'idle', lastRun: '1 day ago', progress: 0, stats: { audits: 12, issues: 3 }, color: 'from-green-500 to-emerald-500' },
            { id: 'operator', name: 'Operator Agent', description: 'System sync', type: 'operator', status: 'running', lastRun: 'Just now', progress: 100, stats: { syncs: 144, errors: 0 }, color: 'from-purple-500 to-indigo-500' },
            { id: 'reporter', name: 'Reporter Agent', description: 'Daily briefings', type: 'reporter', status: 'idle', lastRun: '3 hours ago', progress: 0, stats: { reports: 2, clients: 5 }, color: 'from-yellow-500 to-orange-500' }
        ];

        const defaultLeads = [
            { id: '1', name: 'John Smith', email: 'john@acme.com', company: 'Acme Corp', score: 92, tier: 'HOT', source: 'Hunter Agent', lastActivity: '2 min ago' },
            { id: '2', name: 'Sarah Johnson', email: 'sarah@tech.co', company: 'TechStart Inc', score: 78, tier: 'WARM', source: 'Website', lastActivity: '1 hour ago' },
            { id: '3', name: 'Mike Chen', email: 'mike@global.com', company: 'Global Solutions', score: 45, tier: 'COLD', source: 'LinkedIn', lastActivity: '2 days ago' },
            { id: '4', name: 'Emma Davis', email: 'emma@frozen.io', company: 'Frozen Systems', score: 12, tier: 'ICE', source: 'Outreach', lastActivity: '1 week ago' },
            { id: '5', name: 'Alex Rivera', email: 'alex@scaleup.com', company: 'ScaleUp Inc', score: 85, tier: 'HOT', source: 'Referral', lastActivity: '5 min ago' }
        ];

        // --- Auth Context ---
        const AuthContext = createContext(null);
        const AuthProvider = ({ children }) => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const checkAuth = async () => {
                    if (window.Clerk) {
                        await window.Clerk.load();
                        if (window.Clerk.user) setUser(window.Clerk.user);
                    } else {
                        setUser({ id: 'demo', email: 'demo@blaze.os', firstName: 'Demo' });
                    }
                    setLoading(false);
                };
                checkAuth();
            }, []);

            const signIn = async () => {
                if (window.Clerk) window.Clerk.openSignIn();
                else setUser({ id: 'demo', email: 'demo@blaze.os', firstName: 'Demo' });
            };

            const signOut = async () => {
                if (window.Clerk) await window.Clerk.signOut();
                setUser(null);
            };

            return (
                <AuthContext.Provider value={{ user, loading, signIn, signOut }}>
                    {children}
                </AuthContext.Provider>
            );
        };
        const useAuth = () => useContext(AuthContext);

        // --- Sidebar ---
        const Sidebar = ({ currentPage, setPage }) => {
            const { signOut } = useAuth();
            const navItems = [
                { id: 'dashboard', label: 'Dashboard', icon: 'layout-dashboard' },
                { id: 'tasks', label: 'Tasks', icon: 'check-square' },
                { id: 'agents', label: 'AI Agents', icon: 'bot' },
                { id: 'orchestrator', label: 'Orchestrator', icon: 'git-branch' },
                { id: 'stores', label: 'Stores', icon: 'store' },
                { id: 'leads', label: 'Leads', icon: 'users' },
                { id: 'workflows', label: 'Workflows', icon: 'workflow' },
                { id: 'reports', label: 'Reports', icon: 'bar-chart-3' },
                { id: 'chat', label: 'Chat with Blaze', icon: 'message-circle' },
                { id: 'settings', label: 'Settings', icon: 'settings' },
            ];

            return (
                <aside className="w-64 h-screen glass-card border-r border-white/10 flex flex-col fixed left-0 top-0 z-50">
                    <div className="p-6 flex items-center gap-3 border-b border-white/5">
                        <div className="w-8 h-8 bg-accent rounded-lg flex items-center justify-center glow">
                            <Icon name="flame" size={20} className="text-white" />
                        </div>
                        <span className="font-bold text-xl tracking-tight">Blaze OS</span>
                    </div>
                    
                    <nav className="flex-1 overflow-y-auto py-4 px-3 space-y-1">
                        {navItems.map((item) => (
                            <button
                                key={item.id}
                                onClick={() => setPage(item.id)}
                                className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all ${
                                    currentPage === item.id 
                                    ? 'bg-accent/20 text-accent border border-accent/30' 
                                    : 'text-gray-400 hover:text-white hover:bg-white/5'
                                }`}
                            >
                                <Icon name={item.icon} size={18} />
                                {item.label}
                            </button>
                        ))}
                    </nav>
                    
                    <div className="p-4 border-t border-white/10">
                        <button 
                            onClick={signOut}
                            className="w-full flex items-center gap-2 px-3 py-2 text-sm text-red-400 hover:bg-red-500/10 rounded-lg transition-colors"
                        >
                            <Icon name="log-out" size={16} />
                            Sign Out
                        </button>
                    </div>
                </aside>
            );
        };

        // --- Chat Page (NEW) ---
        const Chat = () => {
            const [messages, setMessages] = useState([
                { id: 1, role: 'assistant', content: 'Hey Zain! üëã I\'m Blaze, your AI automation architect. What can I help you with today?', timestamp: new Date() }
            ]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            useEffect(() => scrollToBottom(), [messages]);

            const handleSend = async () => {
                if (!input.trim() || loading) return;
                
                const userMsg = { id: Date.now(), role: 'user', content: input, timestamp: new Date() };
                setMessages(prev => [...prev, userMsg]);
                setInput('');
                setLoading(true);

                // Simulate AI response
                setTimeout(() => {
                    const responses = {
                        'hello': 'Hey! Ready to automate some workflows? üî•',
                        'status': 'All 6 AI agents are operational. Hunter Agent found 10 new leads.',
                        'leads': 'Last run: 10 qualified leads found. Want me to export them?',
                        'export': 'I\'ll export your leads to CSV now!'
                    };
                    const lower = input.toLowerCase();
                    let response = 'I\'m on it! Let me process that for you. üî•';
                    for (const [key, val] of Object.entries(responses)) {
                        if (lower.includes(key)) { response = val; break; }
                    }
                    
                    setMessages(prev => [...prev, { 
                        id: Date.now() + 1, 
                        role: 'assistant', 
                        content: response, 
                        timestamp: new Date() 
                    }]);
                    setLoading(false);
                }, 1500);
            };

            return (
                <div className="h-full flex flex-col">
                    <div className="flex items-center gap-3 px-6 py-4 border-b border-white/10">
                        <div className="w-10 h-10 bg-gradient-to-br from-accent to-purple-400 rounded-full flex items-center justify-center">
                            <Icon name="bot" size={20} className="text-white" />
                        </div>
                        <div>
                            <h2 className="font-semibold text-white">Blaze Assistant</h2>
                            <p className="text-sm text-green-400">‚óè Online ‚Ä¢ Synced to WhatsApp</p>
                        </div>
                    </div>

                    <div className="flex-1 overflow-y-auto p-6 space-y-4">
                        {messages.map((msg) => (
                            <div key={msg.id} className={`flex gap-3 ${msg.role === 'user' ? 'flex-row-reverse' : ''}`}>
                                <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${msg.role === 'user' ? 'bg-white/10' : 'bg-gradient-to-br from-accent to-purple-400'}`}>
                                    <Icon name={msg.role === 'user' ? 'user' : 'bot'} size={16} className="text-white" />
                                </div>
                                <div className={`chat-message ${msg.role === 'user' ? 'chat-user' : 'chat-assistant'}`}>
                                    <div className="text-sm whitespace-pre-wrap">{msg.content}</div>
                                    <div className="text-xs mt-1 opacity-60">{msg.timestamp.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>
                                </div>
                            </div>
                        ))}
                        {loading && (
                            <div className="flex gap-3">
                                <div className="w-8 h-8 rounded-full bg-gradient-to-br from-accent to-purple-400 flex items-center justify-center">
                                    <Icon name="bot" size={16} className="text-white" />
                                </div>
                                <div className="chat-message chat-assistant">
                                    <div className="flex items-center gap-2">
                                        <div className="w-2 h-2 bg-white/50 rounded-full animate-bounce"></div>
                                        <div className="w-2 h-2 bg-white/50 rounded-full animate-bounce" style={{animationDelay:'0.1s'}}></div>
                                        <div className="w-2 h-2 bg-white/50 rounded-full animate-bounce" style={{animationDelay:'0.2s'}}></div>
                                    </div>
                                </div>
                            </div>
                        )}
                        <div ref={messagesEndRef} />
                    </div>

                    <div className="p-4 border-t border-white/10">
                        <div className="flex items-end gap-2 bg-white/5 rounded-xl p-2">
                            <textarea
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                onKeyDown={(e) => e.key === 'Enter' && !e.shiftKey && (e.preventDefault(), handleSend())}
                                placeholder="Ask Blaze anything..."
                                className="flex-1 bg-transparent text-white placeholder-gray-500 resize-none outline-none min-h-[40px] max-h-[120px] py-2 px-2"
                                rows={1}
                            />
                            <button
                                onClick={handleSend}
                                disabled={!input.trim() || loading}
                                className={`p-2 rounded-lg transition-colors ${input.trim() && !loading ? 'bg-accent hover:bg-accent-hover text-white' : 'bg-white/5 text-gray-500 cursor-not-allowed'}`}
                            >
                                <Icon name="send" size={20} />
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Orchestrator Page (NEW) ---
        const Orchestrator = () => {
            const [agents] = useState(defaultAgents);
            const overallProgress = Math.round(agents.reduce((acc, a) => acc + a.progress, 0) / agents.length);

            const statusColors = {
                idle: 'bg-gray-500',
                running: 'bg-amber-500 animate-pulse',
                completed: 'bg-green-500',
                error: 'bg-red-500',
                working: 'bg-amber-500 animate-pulse'
            };

            return (
                <div className="p-6">
                    <h1 className="text-3xl font-bold text-white mb-2">Task Orchestrator</h1>
                    <p className="text-gray-400 mb-8">Visualize task delegation and agent progress</p>

                    {/* Blaze Orchestrator Node */}
                    <div className="glass-card rounded-xl p-6 mb-8 bg-gradient-to-r from-accent/20 to-purple-500/20 border-accent/30">
                        <div className="flex items-center gap-4">
                            <div className="w-16 h-16 bg-gradient-to-br from-accent to-purple-500 rounded-2xl flex items-center justify-center text-3xl">üî•</div>
                            <div className="flex-1">
                                <h2 className="text-xl font-bold text-white">Blaze Orchestrator</h2>
                                <p className="text-gray-400">Managing 6 AI Agents</p>
                            </div>
                            <div className="text-right">
                                <p className="text-sm text-gray-400">Overall Progress</p>
                                <p className="text-3xl font-bold text-accent">{overallProgress}%</p>
                            </div>
                        </div>
                        <div className="mt-4 h-3 bg-white/10 rounded-full overflow-hidden">
                            <div className="h-full progress-animated rounded-full" style={{width: `${overallProgress}%`}} />
                        </div>
                    </div>

                    {/* Connection */}
                    <div className="flex justify-center mb-8">
                        <div className="flex flex-col items-center">
                            <div className="w-px h-8 bg-gradient-to-b from-accent to-gray-600" />
                            <span className="text-sm text-gray-500">Delegating to 6 AI Agents</span>
                            <div className="w-px h-8 bg-gradient-to-b from-gray-600 to-transparent" />
                        </div>
                    </div>

                    {/* Agent Grid */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4">
                        {agents.map((agent) => (
                            <div key={agent.id} className={`glass-card rounded-xl p-4 ${agent.status === 'running' ? 'ring-2 ring-accent/50' : ''}`}>
                                <div className="flex items-start justify-between mb-3">
                                    <div className="flex items-center gap-3">
                                        <div className="text-2xl">{agent.type === 'hunter' ? 'üéØ' : agent.type === 'outreach' ? 'üì§' : agent.type === 'creator' ? 'üé®' : agent.type === 'auditor' ? 'üîç' : agent.type === 'operator' ? 'üîÑ' : 'üìä'}</div>
                                        <div>
                                            <h3 className="font-semibold text-white">{agent.name}</h3>
                                            <p className="text-xs text-gray-400">{agent.description}</p>
                                        </div>
                                    </div>
                                    <div className={`w-2 h-2 rounded-full ${statusColors[agent.status]}`} />
                                </div>

                                <div className="space-y-2">
                                    <div className="flex items-center justify-between text-xs">
                                        <span className="text-gray-400">Progress</span>
                                        <span className={agent.progress === 100 ? 'text-green-400' : 'text-white'}>{agent.progress}%</span>
                                    </div>
                                    <div className="h-2 bg-white/10 rounded-full overflow-hidden">
                                        <div className={`h-full rounded-full ${agent.progress === 100 ? 'bg-green-500' : 'bg-accent'}`} style={{width: `${agent.progress}%`}} />
                                    </div>
                                </div>

                                {agent.subAgents && (
                                    <div className="mt-4 pt-4 border-t border-white/10 space-y-2">
                                        <p className="text-xs text-gray-500">Sub-agents</p>
                                        {agent.subAgents.map(sub => (
                                            <div key={sub.id} className="flex items-center justify-between text-sm bg-white/5 rounded-lg p-2">
                                                <span className="text-gray-300">{sub.name}</span>
                                                <div className="flex items-center gap-2">
                                                    <div className="w-16 h-1.5 bg-white/10 rounded-full overflow-hidden">
                                                        <div className={`h-full ${sub.progress === 100 ? 'bg-green-500' : 'bg-amber-500'} rounded-full`} style={{width: `${sub.progress}%`}} />
                                                    </div>
                                                    <span className="text-xs text-gray-500">{sub.progress}%</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- Leads Page with CSV Export (UPDATED) ---
        const Leads = () => {
            const [leads, setLeads] = useState([]);
            const [loading, setLoading] = useState(true);
            const [exporting, setExporting] = useState(false);

            useEffect(() => {
                fetch('/api/leads')
                    .then(res => res.json())
                    .then(data => {
                        setLeads(data);
                        setLoading(false);
                    })
                    .catch(err => {
                        console.error('Failed to load leads:', err);
                        setLeads(defaultLeads);
                        setLoading(false);
                    });
            }, []);

            const exportToCSV = () => {
                setExporting(true);
                const headers = ['Name', 'Company', 'Email', 'Score', 'Tier', 'Source', 'Last Activity'];
                const rows = leads.map(l => [l.name, l.company, l.email, l.score, l.tier, l.source, l.lastActivity]);
                const csv = [headers.join(','), ...rows.map(r => r.map(c => `"${c}"`).join(','))].join('\n');
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `blaze-leads-${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                
                setTimeout(() => setExporting(false), 1000);
            };

            const tiers = {
                HOT: { color: 'bg-red-500/20 text-red-400 border-red-500/30', icon: 'flame' },
                WARM: { color: 'bg-orange-500/20 text-orange-400 border-orange-500/30', icon: 'thermometer' },
                COLD: { color: 'bg-blue-500/20 text-blue-400 border-blue-500/30', icon: 'snowflake' },
                ICE: { color: 'bg-gray-500/20 text-gray-400 border-gray-500/30', icon: 'snowflake' }
            };

            return (
                <div className="p-6">
                    <div className="flex justify-between items-center mb-8">
                        <div>
                            <h1 className="text-3xl font-bold text-white">Leads</h1>
                            <p className="text-gray-400">Track and manage your sales pipeline</p>
                        </div>
                        <div className="flex gap-3">
                            <button 
                                onClick={exportToCSV}
                                disabled={exporting}
                                className="glass px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 hover:bg-white/10 disabled:opacity-50"
                            >
                                {exporting ? 'Exporting...' : <><Icon name="download" size={16} /> Export CSV</>}
                            </button>
                            <button className="bg-accent hover:bg-accent-hover px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                + Add Lead
                            </button>
                        </div>
                    </div>

                    <div className="glass-card rounded-xl overflow-hidden">
                    {loading ? (
                        <div className="p-8 text-center text-gray-400">
                            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-accent mx-auto mb-4"></div>
                            Loading leads from database...
                        </div>
                    ) : (
                        <table className="w-full">
                            <thead className="bg-white/5 border-b border-white/10">
                                <tr>
                                    {['Lead', 'Company', 'Score', 'Tier', 'Source', 'Activity'].map(h => (
                                        <th key={h} className="text-left py-4 px-6 text-xs font-medium text-gray-400 uppercase">{h}</th>
                                    ))}
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-white/5">
                                {leads.map((lead) => {
                                    const tier = tiers[lead.tier];
                                    return (
                                        <tr key={lead.id} className="hover:bg-white/5 transition-colors">
                                            <td className="py-4 px-6">
                                                <div className="flex items-center gap-3">
                                                    <div className="w-10 h-10 rounded-full bg-gradient-to-br from-accent to-blue-500 flex items-center justify-center text-sm font-bold text-white">
                                                        {lead.name.split(' ').map(n => n[0]).join('')}
                                                    </div>
                                                    <div>
                                                        <div className="font-medium text-white">{lead.name}</div>
                                                        <div className="text-sm text-gray-500">{lead.email}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td className="py-4 px-6 text-gray-300">{lead.company}</td>
                                            <td className="py-4 px-6">
                                                <div className="flex items-center gap-3">
                                                    <div className="w-16 h-2 bg-white/10 rounded-full overflow-hidden">
                                                        <div className="h-full bg-accent rounded-full" style={{ width: `${lead.score}%` }} />
                                                    </div>
                                                    <span className="text-sm font-medium text-white">{lead.score}</span>
                                                </div>
                                            </td>
                                            <td className="py-4 px-6">
                                                <span className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium border ${tier.color}`}>
                                                    <Icon name={tier.icon} size={12} />
                                                    {lead.tier}
                                                </span>
                                            </td>
                                            <td className="py-4 px-6 text-gray-300">{lead.source}</td>
                                            <td className="py-4 px-6 text-gray-500">{lead.date || lead.lastActivity}</td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                    )}
                    </div>
                </div>
            );
        };

        // --- Other Pages (Simplified) ---
        const Dashboard = () => (
            <div className="p-6 space-y-6">
                <div>
                    <h1 className="text-3xl font-bold text-white">Dashboard</h1>
                    <p className="text-gray-400">Welcome back to Blaze Business OS</p>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    {[
                        { label: 'Total Revenue', value: '$48,294', change: '+12.5%', up: true, icon: 'trending-up' },
                        { label: 'Active Leads', value: '1,284', change: '+8.2%', up: true, icon: 'users' },
                        { label: 'Store Orders', value: '856', change: '-2.1%', up: false, icon: 'shopping-bag' },
                        { label: 'AI Tasks', value: '2,453', change: '+24.0%', up: true, icon: 'zap' },
                    ].map((stat, i) => (
                        <div key={i} className="glass-card rounded-xl p-6 hover:border-accent/30 transition-all">
                            <div className="flex justify-between items-start mb-4">
                                <div className="p-2 bg-accent/20 rounded-lg">
                                    <Icon name={stat.icon} size={20} className="text-accent" />
                                </div>
                                <span className={`flex items-center gap-1 text-xs font-medium ${stat.up ? 'text-green-400' : 'text-red-400'}`}>
                                    <Icon name={stat.up ? 'arrow-up-right' : 'arrow-down-right'} size={12} />
                                    {stat.change}
                                </span>
                            </div>
                            <div className="text-2xl font-bold text-white mb-1">{stat.value}</div>
                            <div className="text-sm text-gray-400">{stat.label}</div>
                        </div>
                    ))}
                </div>
                <div className="glass-card rounded-xl p-6">
                    <h3 className="text-lg font-semibold mb-4 flex items-center gap-2">
                        <Icon name="activity" size={20} className="text-accent" />
                        Recent Activity
                    </h3>
                    <div className="space-y-3">
                        {[
                            'Hunter Agent found 10 new leads',
                            'Shopify sync completed',
                            'Outreach campaign sent to 45 contacts',
                            'New high-value lead: Acme Corp'
                        ].map((action, i) => (
                            <div key={i} className="flex gap-3 items-center py-2 border-b border-white/5 last:border-0">
                                <div className="w-2 h-2 rounded-full bg-accent" />
                                <p className="text-sm text-gray-300">{action}</p>
                                <span className="text-xs text-gray-500 ml-auto">{i + 2} min ago</span>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
        );

        const Tasks = () => {
            const [tasks] = useState(Storage.get('blaze_tasks', defaultTasks));
            const columns = [
                { id: 'todo', title: 'To Do', color: 'bg-gray-500' },
                { id: 'inprogress', title: 'In Progress', color: 'bg-blue-500' },
                { id: 'review', title: 'Review', color: 'bg-yellow-500' },
                { id: 'done', title: 'Done', color: 'bg-green-500' },
            ];
            return (
                <div className="p-6">
                    <h1 className="text-3xl font-bold text-white mb-6">Tasks</h1>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        {columns.map(col => (
                            <div key={col.id} className="glass-card rounded-xl p-4">
                                <div className="flex items-center gap-2 mb-4">
                                    <div className={`w-3 h-3 rounded-full ${col.color}`} />
                                    <h3 className="font-semibold text-white">{col.title}</h3>
                                    <span className="text-xs text-gray-500 bg-white/5 px-2 py-1 rounded-full ml-auto">
                                        {tasks.filter(t => t.status === col.id).length}
                                    </span>
                                </div>
                                <div className="space-y-3">
                                    {tasks.filter(t => t.status === col.id).map(task => (
                                        <div key={task.id} className="glass p-3 rounded-lg hover:border-accent/30 transition-all cursor-pointer">
                                            <h4 className="text-sm font-medium text-white mb-1">{task.title}</h4>
                                            <p className="text-xs text-gray-400">{task.description}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const AIAgents = () => {
            const [agents] = useState(defaultAgents);
            return (
                <div className="p-6">
                    <h1 className="text-3xl font-bold text-white mb-6">AI Agents</h1>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {agents.map(agent => (
                            <div key={agent.id} className="glass-card rounded-xl p-6 hover:border-accent/30 transition-all">
                                <div className="flex items-center gap-4 mb-4">
                                    <div className={`w-12 h-12 rounded-xl bg-gradient-to-br ${agent.color} flex items-center justify-center`}>
                                        <Icon name={agent.type === 'hunter' ? 'target' : agent.type === 'outreach' ? 'mail' : agent.type === 'creator' ? 'image' : agent.type === 'auditor' ? 'search' : agent.type === 'operator' ? 'refresh-cw' : 'file-text'} size={24} className="text-white" />
                                    </div>
                                    <div>
                                        <h3 className="font-semibold text-white">{agent.name}</h3>
                                        <p className="text-xs text-gray-400">{agent.status} ‚Ä¢ {agent.lastRun}</p>
                                    </div>
                                </div>
                                <div className="grid grid-cols-2 gap-3">
                                    {Object.entries(agent.stats).map(([key, val]) => (
                                        <div key={key} className="bg-white/5 rounded-lg p-3">
                                            <div className="text-lg font-bold text-white">{val}</div>
                                            <div className="text-xs text-gray-500 capitalize">{key}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const Stores = () => (
            <div className="p-6">
                <h1 className="text-3xl font-bold text-white mb-6">Stores</h1>
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    {[
                        { name: 'Main Shopify Store', url: 'mystore.myshopify.com', orders: 1234, products: 456, revenue: '$45.2k' },
                        { name: 'WooCommerce Site', url: 'shop.example.com', orders: 567, products: 234, revenue: '$23.1k' }
                    ].map((store, i) => (
                        <div key={i} className="glass-card rounded-xl p-6">
                            <div className="flex items-center gap-4 mb-4">
                                <div className="w-14 h-14 rounded-xl bg-[#96BF48] flex items-center justify-center">
                                    <Icon name="shopping-bag" size={28} className="text-white" />
                                </div>
                                <div>
                                    <h3 className="text-lg font-semibold text-white">{store.name}</h3>
                                    <p className="text-sm text-gray-400">{store.url}</p>
                                </div>
                            </div>
                            <div className="grid grid-cols-3 gap-4">
                                <div className="bg-white/5 rounded-lg p-3 text-center">
                                    <div className="text-lg font-bold text-white">{store.orders}</div>
                                    <div className="text-xs text-gray-500">Orders</div>
                                </div>
                                <div className="bg-white/5 rounded-lg p-3 text-center">
                                    <div className="text-lg font-bold text-white">{store.products}</div>
                                    <div className="text-xs text-gray-500">Products</div>
                                </div>
                                <div className="bg-white/5 rounded-lg p-3 text-center">
                                    <div className="text-lg font-bold text-white">{store.revenue}</div>
                                    <div className="text-xs text-gray-500">Revenue</div>
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        );

        const Placeholder = ({ title, icon }) => (
            <div className="flex items-center justify-center h-64 text-gray-400">
                <div className="text-center">
                    <Icon name={icon} size={48} className="mx-auto mb-4 opacity-50" />
                    <h3 className="text-lg font-medium text-white mb-2">{title}</h3>
                    <p>Coming soon...</p>
                </div>
            </div>
        );

        const Settings = () => (
            <div className="p-6 max-w-2xl">
                <h1 className="text-3xl font-bold text-white mb-8">Settings</h1>
                <div className="glass-card rounded-xl p-6 space-y-6">
                    <div>
                        <h3 className="text-lg font-semibold text-white mb-4">Profile</h3>
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm text-gray-400 mb-1">Display Name</label>
                                <input type="text" defaultValue="Zain" className="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-accent/50" />
                            </div>
                            <div>
                                <label className="block text-sm text-gray-400 mb-1">Email</label>
                                <input type="email" defaultValue="zain@blazeignite.com" className="w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-accent/50" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );

        // --- Main App ---
        const App = () => {
            const [currentPage, setCurrentPage] = useState('dashboard');
            const { user, loading, signIn } = useAuth();

            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [currentPage, user]);

            if (loading) {
                return (
                    <div className="h-screen flex items-center justify-center bg-background">
                        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-accent"></div>
                    </div>
                );
            }

            if (!user) {
                return (
                    <div className="h-screen flex items-center justify-center bg-background relative">
                        <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-accent/20 via-background to-background"></div>
                        <div className="relative z-10 text-center p-8 glass-card rounded-2xl max-w-md w-full mx-4">
                            <div className="w-16 h-16 bg-accent rounded-2xl flex items-center justify-center mx-auto mb-6 glow">
                                <Icon name="flame" size={32} className="text-white" />
                            </div>
                            <h1 className="text-3xl font-bold text-white mb-2">Blaze Business OS</h1>
                            <p className="text-gray-400 mb-8">AI-Powered Business Operating System</p>
                            <button onClick={signIn} className="w-full bg-accent hover:bg-accent-hover text-white font-medium py-3 rounded-lg transition-all">
                                Sign In
                            </button>
                        </div>
                    </div>
                );
            }

            const renderPage = () => {
                switch(currentPage) {
                    case 'dashboard': return <Dashboard />;
                    case 'tasks': return <Tasks />;
                    case 'agents': return <AIAgents />;
                    case 'orchestrator': return <Orchestrator />;
                    case 'stores': return <Stores />;
                    case 'leads': return <Leads />;
                    case 'workflows': return <Placeholder title="Workflow Builder" icon="workflow" />;
                    case 'reports': return <Placeholder title="Reports" icon="bar-chart-3" />;
                    case 'chat': return <Chat />;
                    case 'settings': return <Settings />;
                    default: return <Dashboard />;
                }
            };

            return (
                <div className="flex h-screen bg-background">
                    <Sidebar currentPage={currentPage} setPage={setCurrentPage} />
                    <main className="flex-1 ml-64 overflow-auto scrollbar-hide">
                        {renderPage()}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <AuthProvider>
                <App />
            </AuthProvider>
        );
    </script>
</body>
</html>